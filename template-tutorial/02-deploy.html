<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Install Red Hat Cluster Advanced Management Operator :: Multicluster Application Deployment with Advanced Cluster Management and GitOps</title>
    <link rel="canonical" href="https://xbryan1.github.io/rhte-2023-acm-docs/template-tutorial/02-deploy.html">
    <link rel="prev" href="01-setup.html">
    <link rel="next" href="#03-installcluster.adoc">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://xbryan1.github.io/rhte-2023-acm-docs">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="template-tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#rhpds">RHPDS Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#architecture">LAB Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#tools">Tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-deploy.html">2. Install Red Hat Cluster Advanced Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#install">ACM Operator Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#setup">Setup a MultiClusterHub</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#console">Access to the MultiCluster WebConsole</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#gitops">Integrate GitOps Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#03-installcluster.adoc">3. Install a new Openshift Cluster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#03-installcluster.adoc#credentials">Setup credentials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#03-installcluster.adoc#install">Deploy new Openshift Cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#04-deployapplication.adoc">4. Deploy a Multicluster Application with GitOps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#04-deployapplication.adoc#application">Deploy GitOps Application</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#05-policies.adoc">5. Setup Advanced Cluster Management Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#05-policies.adoc#setup">Configure Policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#06-multiclusterapplication.adoc">6. Advanced Cluster Management Multicluster Application</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#06-policies.adoc#hibernate">Hibernate / Resume OCP Clusters across your domain</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Template Tutorial</a></li>
    <li><a href="02-deploy.html">2. Install Red Hat Cluster Advanced Management</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/xbryan1/rhte-2023-acm-docs/edit/master/documentation/modules/ROOT/pages/02-deploy.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Install Red Hat Cluster Advanced Management Operator</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Advanced Cluster Management (RHACM) is installed through Operator Lifecycle Manager (OLM), which manages the installation, upgrade, and removal of the components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OpenShift Container Platform required access: Cluster administrator (cluster-admin) permissions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The OpenShift Container Platform provided in this lab meet the minimal <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.6/html/install/installing#requirements-and-recommendations">requirements</a> from the official documentation. The cluster hub components will be installed on worker nodes, no <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.6/html/install/installing#installing-on-infra-node">infrastructure</a> nodes will be provided.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_from_the_operatorhub_web_console_interface"><a class="anchor" href="#_installing_from_the_operatorhub_web_console_interface"></a>Installing from the OperatorHub web console interface</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="install"><a class="anchor" href="#install"></a>Installing from the OpenShift Container Platform CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can proceed to install Red Hat Advanced Cluster Management from the CLI, run the following commands</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before install run the installation, take a few seconds to review this YAML file <code>01_acm-operator.yaml</code> which defines the following resources:</p>
<div class="ulist">
<ul>
<li>
<p><code>open-cluster-management</code> namespace</p>
</li>
<li>
<p><code>open-cluster-management-rhte2023</code> OperatorGroup</p>
</li>
<li>
<p><code>advanced-cluster-management</code> subscription</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: v1
kind: Namespace
metadata:
  name: open-cluster-management
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: open-cluster-management-rhte2023
  namespace: open-cluster-management
spec:
  targetNamespaces:
  - open-cluster-management
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: advanced-cluster-management
  namespace: open-cluster-management
spec:
  channel: release-2.6
  installPlanApproval: Automatic
  name: advanced-cluster-management
  source: redhat-operators
  sourceNamespace: openshift-marketplace
  startingCSV: advanced-cluster-management.v2.6.3</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Install Red Hat Advanced Cluster Management Operator and verify that the installation is completed successfully as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc apply -f 01_acm-operator.yaml

$ oc get csv advanced-cluster-management.v2.6.3
NAME                                 DISPLAY                                      VERSION   REPLACES                             PHASE
advanced-cluster-management.v2.6.3   Advanced Cluster Management for Kubernetes   2.6.3     advanced-cluster-management.v2.6.2   Succeeded</code></pre>
</div>
</div>
</div>
</div>
<h1 id="setup" class="sect0"><a class="anchor" href="#setup"></a>Setup a MulticlusterHub</h1>
<div class="paragraph">
<p>Once the RHACM Operator is already completed, proceed with the next step to create RHACM cluster hub, and verify the installation checking that the hub cluster status is in <code>Running</code> and all pods in namespace <code>open-cluster-management</code> are also in <code>Running</code> status:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc apply -f 02_acm-multicluster.yaml

$ oc get mch -o=jsonpath='{.items[0].status.phase}' -n open-cluster-management

$ oc get pod -n open-cluster-management</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the cluster hub is in <code>installing</code> status indefinitely, check the operator logs as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc logs multiclusterhub-operator-xxx-xxx -n open-cluster-management</code></pre>
</div>
</div>
<h1 id="console" class="sect0"><a class="anchor" href="#console"></a>Access to the MultiCluster WebConsole</h1>
<div class="paragraph">
<p>Once the RHACM cluster hub installation is completed, proceed getting the route where you will find your ACM Console&#8217;s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get routes
NAME                 HOST/PORT                                          PATH   SERVICES             PORT    TERMINATION          WILDCARD
multicloud-console   multicloud-console.apps.jclaretm.nasatam.support          management-ingress   https   reencrypt/Redirect   None</code></pre>
</div>
</div>
<h1 id="gitops" class="sect0"><a class="anchor" href="#gitops"></a>Integrate GitOps Operator</h1>
<div class="paragraph">
<p>RHACM introduces a new <code>gitopscluster</code> resource kind, which connects to a <code>placement</code> resource to determine which clusters to import into Argo CD. This integration allows you to expand your fleet, while having Argo CD automatically engage in working with your new clusters. This means if you leverage Argo CD <code>ApplicationSets`</code>, your application payloads are automatically applied to your new clusters as they are registered by RHACM in your Argo CD instances.</p>
</div>
<div class="paragraph">
<p>In order to integrate the Red Hat GitOps operator and the Advance Cluster Management cluster hub already deployed, run the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before proceed with the steps to integrate the GitOps Operator with RHACM, take a few seconds to review this YAML file <code>03_acm-gitops.yaml</code> which defines the following resources:</p>
<div class="ulist">
<ul>
<li>
<p><code>openshift-gitops</code> namespace</p>
</li>
<li>
<p><code>openshift-gitops-opertator</code> subscription</p>
</li>
<li>
<p><code>gitops-clusters</code> ManagedClusterSet</p>
</li>
<li>
<p><code>gitops-clusters</code> ManagedClusterSetBinding</p>
</li>
<li>
<p><code>gitops-clusters</code> Placement</p>
</li>
<li>
<p><code>argo-acm-importer</code> GitOpsCluster and</p>
</li>
<li>
<p><code>cluster</code> GitopsService</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># oc apply -f 03_acm-gitops.yaml
---
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-gitops
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: openshift-gitops-operator
  namespace: openshift-operators
spec:
  channel: gitops-1.6
  installPlanApproval: Automatic
  name: openshift-gitops-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace
  startingCSV: openshift-gitops-operator.v1.6.1
---
apiVersion: cluster.open-cluster-management.io/v1beta1
kind: ManagedClusterSet
metadata:
  name: gitops-clusters
spec: {}
---
apiVersion: cluster.open-cluster-management.io/v1beta1
kind: ManagedClusterSetBinding
metadata:
  name: gitops-clusters
  namespace: openshift-gitops
spec:
  clusterSet: gitops-clusters
---
apiVersion: cluster.open-cluster-management.io/v1beta1
kind: Placement
metadata:
  name: gitops-clusters
  namespace: openshift-gitops
spec:
  predicates:
  - requiredClusterSelector:
      labelSelector:
        matchExpressions:
        - key: vendor
          operator: "In"
          values:
          - OpenShift
---
apiVersion: apps.open-cluster-management.io/v1beta1
kind: GitOpsCluster
metadata:
  name: argo-acm-importer
  namespace: openshift-gitops
spec:
  argoServer:
    cluster: local-cluster
    argoNamespace: openshift-gitops
  placementRef:
    kind: Placement
    apiVersion: cluster.open-cluster-management.io/v1alpha1
    name: gitops-clusters
    namespace: openshift-gitops
---
apiVersion: pipelines.openshift.io/v1alpha1
kind: GitopsService
metadata:
  name: cluster
spec: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the following commands to perform the GitOps Operator integration with RHACM</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc apply -f 03_acm-gitops.yaml

$ oc apply -f 04_acm-gitopservice.yaml</code></pre>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-setup.html">1. Environment Setup</a></span>
  <span class="next"><a href="#03-installcluster.adoc">3. Install a new Openshift Cluster</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
